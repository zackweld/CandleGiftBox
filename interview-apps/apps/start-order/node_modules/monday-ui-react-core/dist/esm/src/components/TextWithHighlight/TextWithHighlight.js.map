{"version":3,"file":"TextWithHighlight.js","sources":["../../../../../src/components/TextWithHighlight/TextWithHighlight.tsx"],"sourcesContent":["import { ComponentDefaultTestId, getTestId } from \"../../tests/test-ids-utils\";\nimport cx from \"classnames\";\nimport React, { forwardRef, useLayoutEffect, useMemo, useRef } from \"react\";\nimport Tooltip from \"../../components/Tooltip/Tooltip\";\nimport useIsOverflowing from \"../../hooks/useIsOverflowing/useIsOverflowing\";\nimport useMergeRef from \"../../hooks/useMergeRef\";\nimport VibeComponentProps from \"../../types/VibeComponentProps\";\nimport { DialogPosition } from \"../../constants\";\nimport styles from \"./TextWithHighlight.module.scss\";\n\nconst getTextPart = (\n  text: string,\n  key: number,\n  shouldHighlight: boolean,\n  wrappingTextTag: keyof JSX.IntrinsicElements = \"em\",\n  wrappingElementClassName: string\n) => {\n  const WrappingElement = wrappingTextTag;\n  if (shouldHighlight) {\n    return (\n      <WrappingElement className={cx(styles.highlightText, wrappingElementClassName)} key={key}>\n        {text}\n      </WrappingElement>\n    );\n  }\n  return <span key={key}>{text}</span>;\n};\n\nexport interface TextWithHighlightProps extends VibeComponentProps {\n  /** Text to wrap */\n  text?: string;\n  highlightTerm?: string;\n  /** Number of highlighted parts */\n  limit?: number;\n  ignoreCase?: boolean;\n  /** Should use ellipsis */\n  useEllipsis?: boolean;\n  /** Allow highlight every word as a separate term */\n  allowTermSplit?: boolean;\n  linesToClamp?: number;\n  /** Tooltip to show when there is no overflow */\n  nonEllipsisTooltip?: string;\n  /** HTML tag to wrap the selected text */\n  wrappingTextTag?: keyof JSX.IntrinsicElements;\n  wrappingElementClassName?: string;\n  tooltipPosition?: DialogPosition;\n}\n\nconst TextWithHighlight: React.FC<TextWithHighlightProps> = forwardRef(\n  (\n    {\n      className,\n      id,\n      text = \"\",\n      highlightTerm,\n      limit,\n      useEllipsis = true,\n      linesToClamp = 3,\n      ignoreCase = true,\n      allowTermSplit = true,\n      nonEllipsisTooltip,\n      tooltipPosition,\n      wrappingTextTag = \"em\",\n      wrappingElementClassName,\n      \"data-testid\": dataTestId\n    },\n    ref\n  ) => {\n    const componentRef = useRef(null);\n    const mergedRef = useMergeRef(ref, componentRef);\n\n    const textWithHighlights = useMemo(() => {\n      if (!text || !highlightTerm || limit === 0) return text;\n      let finalTerm = escapeRegExp(highlightTerm);\n      if (allowTermSplit) {\n        finalTerm = finalTerm.split(\" \").join(\"|\");\n      }\n      const regex = new RegExp(`(${finalTerm})`, ignoreCase ? \"i\" : \"\");\n      const tokens = text.split(regex);\n      const parts = [];\n      // Tokens include the term search (in odd indices)\n      let highlightTermsCount = 0;\n      let key = 0;\n      for (let i = 0; i < tokens.length; i++) {\n        // skip empty tokens\n        if (tokens[i]) {\n          // adding highlight part\n          const isTermPart = i % 2 === 1;\n          const shouldHighlight = isTermPart && (!limit || limit < 0 || highlightTermsCount < limit);\n          parts.push(getTextPart(tokens[i], key++, shouldHighlight, wrappingTextTag, wrappingElementClassName));\n          if (isTermPart) highlightTermsCount++;\n        }\n      }\n\n      return parts;\n    }, [text, highlightTerm, limit, ignoreCase, allowTermSplit, wrappingTextTag, wrappingElementClassName]);\n\n    const isOverflowing = useIsOverflowing({ ref: useEllipsis && componentRef });\n\n    useLayoutEffect(() => {\n      if (componentRef.current) {\n        componentRef.current.style.setProperty(\"--heading-clamp-lines\", linesToClamp.toString());\n      }\n    }, [componentRef, linesToClamp, isOverflowing]);\n\n    const Element = (\n      <div\n        ref={mergedRef}\n        className={cx(styles.textWithHighlightWrapper, className, {\n          [styles.withEllipsis]: useEllipsis\n        })}\n        id={id}\n        data-testid={dataTestId || getTestId(ComponentDefaultTestId.TEXT_WITH_HIGHLIGHT, id)}\n      >\n        {textWithHighlights}\n      </div>\n    );\n\n    if (isOverflowing || nonEllipsisTooltip) {\n      const tooltipContent = isOverflowing ? text : nonEllipsisTooltip;\n      return (\n        <Tooltip content={tooltipContent} position={tooltipPosition}>\n          {Element}\n        </Tooltip>\n      );\n    }\n    return Element;\n  }\n);\n\nexport default TextWithHighlight;\n\nfunction escapeRegExp(string: string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n"],"names":["getTextPart","text","key","shouldHighlight","React","arguments","length","undefined","className","cx","styles","highlightText","TextWithHighlight","forwardRef","_ref","ref","id","_ref$text","highlightTerm","limit","_ref$useEllipsis","useEllipsis","_ref$linesToClamp","linesToClamp","_ref$ignoreCase","ignoreCase","_ref$allowTermSplit","allowTermSplit","nonEllipsisTooltip","tooltipPosition","_ref$wrappingTextTag","wrappingTextTag","wrappingElementClassName","dataTestId","componentRef","useRef","mergedRef","useMergeRef","textWithHighlights","useMemo","finalTerm","replace","split","join","regex","RegExp","concat","tokens","parts","highlightTermsCount","i","isTermPart","push","isOverflowing","useIsOverflowing","useLayoutEffect","current","style","setProperty","Element","createElement","textWithHighlightWrapper","_defineProperty","withEllipsis","getTestId","ComponentDefaultTestId","TEXT_WITH_HIGHLIGHT","Tooltip","content","position"],"mappings":"8cAUA,IAAMA,EAAc,SAClBC,EACAC,EACAC,GAKA,OAAIA,EAEAC,gBAN2CC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAA,KAM3B,CAACG,UAAWC,EAAGC,EAAOC,cALVN,UAAAC,OAAAD,EAAAA,kBAAAE,GAKoDL,IAAKA,GAClFD,GAIAG,wBAAMF,IAAKA,GAAMD,EAC1B,EAsBMW,EAAsDC,GAC1D,SAAAC,EAiBEC,GACE,IAhBAP,EAASM,EAATN,UACAQ,EAAEF,EAAFE,GAAEC,EAAAH,EACFb,KAAAA,OAAO,IAAHgB,EAAG,GAAEA,EACTC,EAAaJ,EAAbI,cACAC,EAAKL,EAALK,MAAKC,EAAAN,EACLO,YAAAA,OAAc,IAAHD,GAAOA,EAAAE,EAAAR,EAClBS,aAAAA,OAAe,IAAHD,EAAG,EAACA,EAAAE,EAAAV,EAChBW,WAAAA,OAAa,IAAHD,GAAOA,EAAAE,EAAAZ,EACjBa,eAAAA,OAAiB,IAAHD,GAAOA,EACrBE,EAAkBd,EAAlBc,mBACAC,EAAef,EAAfe,gBAAeC,EAAAhB,EACfiB,gBAAAA,OAAkB,IAAHD,EAAG,KAAIA,EACtBE,EAAwBlB,EAAxBkB,yBACeC,EAAUnB,EAAzB,eAIIoB,EAAeC,EAAO,MACtBC,EAAYC,EAAYtB,EAAKmB,GAE7BI,EAAqBC,GAAQ,WACjC,IAAKtC,IAASiB,GAA2B,IAAVC,EAAa,OAAOlB,EACnD,IAAIuC,EAAyBtB,EA4DnBuB,QAAQ,sBAAuB,QA3DrCd,IACFa,EAAYA,EAAUE,MAAM,KAAKC,KAAK,MAQxC,IANA,IAAMC,EAAYC,WAAMC,OAAKN,EAAS,KAAKf,EAAa,IAAM,IACxDsB,EAAS9C,EAAKyC,MAAME,GACpBI,EAAQ,GAEVC,EAAsB,EACtB/C,EAAM,EACDgD,EAAI,EAAOH,EAAOzC,OAAX4C,EAAmBA,IAEjC,GAAIH,EAAOG,GAAI,CAEb,IAAMC,EAAaD,EAAI,GAAM,EAE7BF,EAAMI,KAAKpD,EAAY+C,EAAOG,GAAIhD,IADViD,KAAgBhC,GAAiB,EAARA,GAAmCA,EAAtB8B,GACJlB,EAAiBC,IACvEmB,GAAYF,GACjB,CAGH,OAAOD,CACT,GAAG,CAAC/C,EAAMiB,EAAeC,EAAOM,EAAYE,EAAgBI,EAAiBC,IAEvEqB,EAAgBC,EAAiB,CAAEvC,IAAKM,GAAea,IAE7DqB,GAAgB,WACVrB,EAAasB,SACftB,EAAasB,QAAQC,MAAMC,YAAY,wBAAyBnC,KAEnE,GAAE,CAACW,EAAcX,EAAc8B,IAEhC,IAAMM,EACJvD,EACEwD,cAAA,MAAA,CAAA7C,IAAKqB,EACL5B,UAAWC,EAAGC,EAAOmD,yBAA0BrD,EAASsD,KACrDpD,EAAOqD,aAAe1C,IAEzBL,GAAIA,EACS,cAAAiB,GAAc+B,EAAUC,EAAuBC,oBAAqBlD,IAEhFsB,GAIL,OAAIe,GAAiBzB,EAGjBxB,EAAAwD,cAACO,EAAO,CAACC,QAFYf,EAAgBpD,EAAO2B,EAEVyC,SAAUxC,GACzC8B,GAIAA,CACT"}