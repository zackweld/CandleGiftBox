import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import i,{forwardRef as t,useRef as n,useState as r,useCallback as s,useMemo as a,useLayoutEffect as d}from"react";import l from"classnames";import{camelCase as p}from"lodash-es";import{isForwardRef as g}from"react-is";import c from"../Dialog/Dialog.js";import m from"../DialogContentContainer/DialogContentContainer.js";import u from"../Tooltip/Tooltip.js";import{backwardCompatibilityForProperties as f}from"../../helpers/backwardCompatibilityForProperties.js";import h from"../../hooks/useMergeRef.js";import{BUTTON_ICON_SIZE as T}from"../Button/ButtonConstants.js";import{withStaticProps as E}from"../../types/withStaticProps.js";import{MenuButtonSize as C,MenuButtonComponentPosition as v}from"./MenuButtonConstants.js";import{AnimationType as S}from"../../constants/dialog.js";import"../../constants/sizes.js";import"../../constants/positions.js";import{HideShowEvent as w}from"../Dialog/consts/dialog-show-hide-event.js";import{NOOP as M}from"../../utils/function-utils.js";import{getStyle as j}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as P,ComponentDefaultTestId as O}from"../../tests/testIds.js";import b from"./MenuButton.module.scss.js";import y from"../Icon/Icons/components/Menu.js";var N=[u.hideShowTriggers.MOUSE_ENTER],A=[w.CLICK,w.ENTER],D=[],I={main:8,secondary:0},R=t((function(t,E){var v=t.id,w=t.className,_=t.componentClassName,z=t.openDialogComponentClassName,B=t.children,L=t.component,H=void 0===L?y:L,K=t.componentPosition,U=void 0===K?R.componentPositions.START:K,x=t.size,k=void 0===x?C.SMALL:x,Y=t.open,F=void 0!==Y&&Y,W=t.onClick,X=void 0===W?M:W,V=t.zIndex,G=void 0===V?null:V,q=t.ariaLabel,J=void 0===q?"Menu":q,Q=t.closeDialogOnContentClick,Z=void 0!==Q&&Q,$=t.closeMenuOnItemClick,ee=t.dialogOffset,oe=void 0===ee?I:ee,ie=t.dialogPosition,te=void 0===ie?c.positions.BOTTOM_START:ie,ne=t.dialogClassName,re=t.dialogPaddingSize,se=void 0===re?m.sizes.MEDIUM:re,ae=t.dialogShowTriggerIgnoreClass,de=t.dialogHideTriggerIgnoreClass,le=t.onMenuHide,pe=void 0===le?M:le,ge=t.onMenuShow,ce=void 0===ge?M:ge,me=t.disabled,ue=void 0!==me&&me,fe=t.text,he=t.tooltipContent,Te=t.tooltipProps,Ee=t.disabledReason,Ce=t.tooltipTriggers,ve=void 0===Ce?[R.hideTriggers.MOUSE_LEAVE]:Ce,Se=t.tooltipPosition,we=void 0===Se?R.dialogPositions.RIGHT:Se,Me=t.startingEdge,je=void 0===Me?"bottom":Me,Pe=t.removeTabCloseTrigger,Oe=void 0!==Pe&&Pe,be=t.tooltipReferenceClassName,ye=t.hideWhenReferenceHidden,Ne=void 0!==ye&&ye,Ae=t.dialogContainerSelector,De=t.active,Ie=t.triggerElement,Re=void 0===Ie?"button":Ie,_e=t.showTooltipOnlyOnTriggerElement,ze=t["data-testid"],Be=n(null),Le=h(E,Be),He=r(F),Ke=e(He,2),Ue=Ke[0],xe=Ke[1],ke=null!=De?De:Ue,Ye=s((function(e){pe(),xe(!1);var o=Be.current;o&&e&&window.requestAnimationFrame((function(){o.focus()}))}),[pe]),Fe=s((function(e){var o="Escape"===(null==e?void 0:e.key);(o||$)&&e.propagate&&Ye(o)}),[$,Ye]),We=s((function(e,o){Ye(o===c.hideShowTriggers.ESCAPE_KEY)}),[Ye]),Xe=s((function(){xe(!0),ce()}),[xe,ce]),Ve=a((function(){var e=new Set([c.hideShowTriggers.CLICK_OUTSIDE,c.hideShowTriggers.TAB_KEY,c.hideShowTriggers.ESCAPE_KEY]);return Z&&(e.add(c.hideShowTriggers.CONTENT_CLICK),e.add(c.hideShowTriggers.ENTER)),Oe&&e.delete(c.hideShowTriggers.TAB_KEY),[i.Children.toArray(B).map((function(o){if(!i.isValidElement(o))return null;var t={};return o.type&&o.type.supportFocusOnMount&&(t.focusOnMount=!0,e.delete(c.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(t.onClose=Fe),i.cloneElement(o,t)})),Array.from(e)]}),[B,Fe,Z,Oe]),Ge=e(Ve,2),qe=Ge[0],Je=Ge[1],Qe=a((function(){return 0===qe.length?null:i.createElement(m,{size:se,type:m.types.POPOVER},qe)}),[qe,se]),Ze=a((function(){return Object.assign(Object.assign({},I),oe)}),[oe]),$e=H,eo=a((function(){switch(k){case C.XXS:case C.XS:return 16;case C.SMALL:case C.MEDIUM:case C.LARGE:return T;default:return 24}}),[k]),oo=$e?i.createElement($e,{size:""+eo,role:"img","aria-hidden":"true"}):null;d((function(){xe(F)}),[F,xe]);var io=f([he,Ee]),to=f([w,_]),no="button"===Re?{ref:Le}:{active:ke,disabled:ue,ref:g(Re)?Le:void 0},ro=i.createElement(Re,Object.assign({id:v,"data-testid":ze||P(O.MENU_BUTTON,v),type:"button",className:l(b.wrapper,to,j(b,p("size-".concat(k))),o(o(o(o({},b.active,ke),j(b,z),Ue&&z),b.disabled,ue),b.text,fe)),"aria-haspopup":"true","aria-expanded":Ue,"aria-label":!fe&&J,onMouseUp:function(e){ue?e.currentTarget.blur():X(e)},"aria-disabled":ue},no),U===R.componentPositions.START&&oo,fe&&i.createElement("span",{className:b.innerText},fe),U===R.componentPositions.END&&oo),so=function(e){return i.createElement(c,{wrapperClassName:ne,position:te,containerSelector:Ae,startingEdge:je,animationType:S.EXPAND,content:Qe,moveBy:Ze,showTrigger:ue?D:A,hideTrigger:Je,showTriggerIgnoreClass:ae,hideTriggerIgnoreClass:de,useDerivedStateFromProps:!0,onDialogDidShow:Xe,onDialogDidHide:We,zIndex:G,isOpen:Ue,hideWhenReferenceHidden:Ne},e)},ao=function(e){return i.createElement(u,Object.assign({content:io,position:we,showTrigger:N,hideTrigger:ve,referenceWrapperClassName:be,hideWhenReferenceHidden:Ne},Te),e)};return _e?so(ao(ro)):ao(so(ro))})),_=E(R,{sizes:C,paddingSizes:m.sizes,dialogPositions:c.positions,hideTriggers:c.hideShowTriggers,componentPositions:v});export{_ as default};
//# sourceMappingURL=MenuButton.js.map
