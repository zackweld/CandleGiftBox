import{slicedToArray as t}from"../../../_virtual/_rollupPluginBabelHelpers.js";import e from"classnames";import i,{forwardRef as r,useState as o,useMemo as n,useRef as l,useCallback as a,useEffect as s}from"react";import{noop as c}from"lodash-es";import{VariableSizeList as u}from"react-window";import f from"react-virtualized-auto-sizer";import m from"../../hooks/usePrevious/index.js";import d from"../../hooks/useThrottledCallback.js";import v from"../../hooks/useMergeRef.js";import{getNormalizedItems as h,getMaxOffset as p,easeInOutQuint as I,getOnItemsRenderedData as S,isLayoutDirectionScrollbarVisible as g}from"../../services/virtualized-service.js";import{getTestId as T}from"../../tests/testIds.js";import{ComponentDefaultTestId as z}from"../../tests/constants.js";import O from"./VirtualizedList.module.scss.js";var b=r((function(r,b){var y=r.className,C=r.id,j=r.items,R=void 0===j?[]:j,w=r.itemRenderer,F=void 0===w?function(t,e,i){return t}:w,x=r.getItemHeight,L=void 0===x?function(t,e){return t.height}:x,V=r.getItemSize,k=void 0===V?null:V,A=r.layout,D=void 0===A?"vertical":A,E=r.onScroll,M=r.overscanCount,N=void 0===M?0:M,U=r.getItemId,_=void 0===U?function(t,e){return t.id}:U,q=r.scrollToId,H=r.scrollDuration,P=void 0===H?200:H,W=r.onScrollToFinished,B=void 0===W?c:W,Z=r.onItemsRendered,G=r.onItemsRenderedThrottleMs,J=void 0===G?200:G,K=r.onSizeUpdate,Q=void 0===K?c:K,X=r.onVerticalScrollbarVisiblityChange,Y=void 0===X?null:X,$=r.onLayoutDirectionScrollbarVisibilityChange,tt=void 0===$?null:$,et=r.virtualListRef,it=r.scrollableClassName,rt=r.role,ot=r.style,nt=r["data-testid"],lt=o(0),at=t(lt,2),st=at[0],ct=at[1],ut=o(0),ft=t(ut,2),mt=ft[0],dt=ft[1],vt="horizontal"!==D,ht=n((function(){return vt?st:mt}),[vt,st,mt]),pt=m(q),It=l(null),St=l(null),gt=l(null),Tt=l(0),zt=l({initialized:!1,scrollOffsetInitial:0,scrollOffsetFinal:0,animationStartTime:0}),Ot=v(b,It),bt=v(et,gt),yt=zt.current;yt.initialized||(yt.initialized=!0,yt.scrollOffsetInitial=0,yt.scrollOffsetFinal=0,yt.animationStartTime=0);var Ct=a((function(t,e){var i=(k||L)(t,e);return void 0===i&&console.error("Couldn't get height for item: ",t),i}),[L,k]),jt=a((function(t,e){var i=_(t,e);return void 0===i&&console.error("Couldn't get id for item: ",t),i}),[_]),Rt=n((function(){return h(R,jt,Ct)}),[R,jt,Ct]),wt=n((function(){return p(ht,Rt)}),[ht,Rt]),Ft=a((function(t){var e=t.scrollDirection,i=t.scrollOffset,r=t.scrollUpdateWasRequested;Tt.current=i,r||(yt.scrollOffsetInitial=i),E&&E(e,i,r)}),[E,Tt,yt]),xt=a((function(){requestAnimationFrame((function(){var t,e=performance.now()-yt.animationStartTime,i=yt.scrollOffsetFinal-yt.scrollOffsetInitial,r=I(Math.min(1,e/P)),o=Math.min(wt,yt.scrollOffsetInitial+i*r);Tt.current=o,null===(t=gt.current)||void 0===t||t.scrollTo(o),P>e?xt():(yt.animationStartTime=void 0,B&&B())}))}),[P,yt,gt,wt,B]),Lt=a((function(t){var e=t.offsetTop;yt.animationStartTime?yt.scrollOffsetFinal=e:yt.scrollOffsetInitial!==e?(yt.scrollOffsetFinal=e,yt.animationStartTime=performance.now(),xt()):B&&B()}),[yt,xt,B]),Vt=a((function(t){var e=t.index;return F(R[e],e,t.style)}),[R,F]),kt=a((function(t){return Ct(R[t],t)}),[R,Ct]),At=a((function(t,e){e===st&&t===mt||setTimeout((function(){ct(e),dt(t),Q(t,e)}),0)}),[st,mt,Q]),Dt=d((function(t){if(Z){var e=S(R,Rt,jt,t.visibleStartIndex,t.visibleStopIndex,ht,Tt.current);Z(e)}}),{wait:J,trailing:!0},[Z,R,Rt,jt,ht]);return s((function(){if(q&&pt!==q){var t=g(R,Rt,jt,ht),e=Rt[q];t&&e&&Lt(e)}}),[pt,q,Lt,Rt,R,jt,ht]),s((function(){gt.current&&gt.current.resetAfterIndex(0)}),[Rt]),s((function(){var t=tt||Y;if(t){var e=g(R,Rt,jt,ht);St.current!==e&&(St.current=e,t(e))}}),[tt,Y,R,Rt,ht,jt]),i.createElement("div",{ref:Ot,className:e(O.virtualizedListWrapper,y),id:C,role:rt,"data-testid":nt||T(z.VIRTUALIZED_LIST,C),style:ot},i.createElement(f,null,(function(t){var e=t.height,r=t.width;return At(r,e),i.createElement(u,{ref:bt,height:e,width:r,itemCount:R.length,itemSize:kt,onScroll:Ft,layout:D,overscanCount:N,onItemsRendered:Dt,className:it},Vt)})))}));export{b as default};
//# sourceMappingURL=VirtualizedList.js.map
