{"version":3,"file":"ComboboxHelpers.js","sources":["../../../../../../src/components/Combobox/ComboboxHelpers/ComboboxHelpers.tsx"],"sourcesContent":["import React, { CSSProperties, MutableRefObject, useMemo } from \"react\";\nimport cx from \"classnames\";\nimport ComboboxOption from \"../components/ComboboxOption/ComboboxOption\";\nimport ComboboxCategory from \"../components/ComboboxCategory/ComboboxCategory\";\nimport Divider from \"../../Divider/Divider\";\nimport {\n  COMBOBOX_DIVIDER_ITEM,\n  COMBOBOX_CATEGORY_ITEM,\n  COMBOBOX_OPTION_ITEM,\n  IComboboxCategory,\n  IComboboxOption,\n  IComboboxCategoryMap,\n  IComboboxItem,\n  IOptionItemRendererArgs,\n  IComboboxOptionEvents\n} from \"../components/ComboboxConstants\";\nimport useActiveDescendantListFocus from \"../../../hooks/useActiveDescendantListFocus\";\nimport { getOptionsByCategories } from \"../ComboboxService\";\nimport comboboxItemsStyles from \"../components/ComboboxItems/ComboboxItems.module.scss\";\nimport styles from \"./ComboboxHelpers.module.scss\";\n\nconst DIVIDER_HEIGHT = 17;\nconst CATEGORY_HEIGHT = 32;\n\nexport function useItemsData({\n  categories,\n  options,\n  filterValue,\n  withCategoriesDivider,\n  optionLineHeight\n}: {\n  categories: IComboboxCategoryMap;\n  options: IComboboxOption[];\n  filterValue: string;\n  withCategoriesDivider: boolean;\n  optionLineHeight: number;\n}) {\n  return useMemo(() => {\n    let items: IComboboxItem[] = [];\n    let selectableItems: IComboboxOption[] = [];\n    const itemsMap = new Map();\n\n    if (categories) {\n      const optionsByCategories = getOptionsByCategories(options, categories, filterValue);\n      let optionIndex = 0;\n      Object.keys(optionsByCategories).forEach((categoryId, categoryIndex) => {\n        const withDivider = withCategoriesDivider && categoryIndex !== 0;\n        if (withDivider) {\n          items.push(createDividerItemObject({ categoryId }));\n        }\n\n        const isCategoryWithOptions = optionsByCategories[categoryId].length > 0;\n        const isFirstCategory = categoryIndex === 0;\n\n        const categoryObject = createCategoryItemObject({\n          categoryId,\n          categoryData: categories[categoryId],\n          withDivider,\n          className: cx({\n            [comboboxItemsStyles.categoryWithOptions]: isCategoryWithOptions,\n            [comboboxItemsStyles.categoryWithoutOptions]: !isCategoryWithOptions,\n            [comboboxItemsStyles.firstCategory]: isFirstCategory\n          })\n        });\n\n        // save category object in both items array and categories map\n        items.push(categoryObject);\n        itemsMap.set(categoryId, categoryObject);\n\n        optionsByCategories[categoryId].forEach((option: IComboboxOption) => {\n          const itemObject = createOptionItemObject({\n            height: optionLineHeight,\n            option,\n            index: optionIndex,\n            categoryId: categoryObject.id\n          });\n\n          itemsMap.set(itemObject.id, itemObject);\n          items.push(itemObject);\n          selectableItems.push(option);\n          optionIndex++;\n        });\n      });\n    } else {\n      selectableItems = options;\n      items = options.map((option, index) => {\n        return createOptionItemObject({\n          height: optionLineHeight,\n          option,\n          index\n        });\n      });\n    }\n    return { items, itemsMap, selectableItems };\n  }, [categories, options, filterValue, withCategoriesDivider, optionLineHeight]);\n}\n\nexport function useKeyboardNavigation({\n  defaultVisualFocusFirstIndex,\n  inputRef,\n  onClick,\n  isChildSelectable,\n  options,\n  getOptionId\n}: {\n  defaultVisualFocusFirstIndex?: boolean;\n  inputRef: MutableRefObject<HTMLElement>;\n  onClick: (event: React.KeyboardEvent | React.MouseEvent, index: number) => void;\n  isChildSelectable: (index: number) => boolean;\n  options: IComboboxOption[];\n  getOptionId: (optionId: string, index: number) => string;\n}) {\n  const filteredOptionsIds = useMemo(\n    () => options.map((option: IComboboxOption, index: number) => getOptionId(option?.id, index)),\n    [getOptionId, options]\n  );\n\n  const {\n    visualFocusItemIndex,\n    visualFocusItemId,\n    onItemClickCallback: onOptionClick\n  } = useActiveDescendantListFocus({\n    defaultVisualFocusFirstIndex,\n    focusedElementRef: inputRef,\n    focusedElementRole: useActiveDescendantListFocus.roles.COMBOBOX,\n    itemsIds: filteredOptionsIds,\n    onItemClick: onClick,\n    isItemSelectable: isChildSelectable,\n    isIgnoreSpaceAsItemSelection: true\n  });\n\n  return { visualFocusItemIndex, visualFocusItemId, onOptionClick };\n}\nexport function createDividerItemObject({ categoryId }: { categoryId: string }): IComboboxItem {\n  return { type: COMBOBOX_DIVIDER_ITEM, height: DIVIDER_HEIGHT, id: `${categoryId}-divider` };\n}\n\nexport function createCategoryItemObject({\n  withDivider,\n  categoryId,\n  categoryData,\n  className\n}: {\n  withDivider: boolean;\n  categoryId: string;\n  categoryData: IComboboxCategory;\n  className: string;\n}): IComboboxItem {\n  return {\n    height: CATEGORY_HEIGHT,\n    type: COMBOBOX_CATEGORY_ITEM,\n    category: categoryData,\n    id: categoryId,\n    withDivider,\n    className\n  };\n}\n\nexport function createOptionItemObject({\n  option,\n  height,\n  index,\n  optionRenderer,\n  isActive,\n  optionLineHeight,\n  shouldScrollToSelectedItem,\n  categoryId\n}: {\n  option?: IComboboxOption;\n  height?: number;\n  index?: number;\n  optionRenderer?: (option: IComboboxOption) => JSX.Element;\n  isActive?: boolean;\n  optionLineHeight?: number;\n  shouldScrollToSelectedItem?: boolean;\n  categoryId?: string;\n}): IComboboxItem {\n  return {\n    type: COMBOBOX_OPTION_ITEM,\n    height,\n    belongToCategory: true,\n    index,\n    option,\n    id: option.id || index.toString(),\n    optionRenderer,\n    isActive,\n    optionLineHeight,\n    shouldScrollToSelectedItem,\n    categoryId\n  };\n}\n\nexport function comboboxItemRenderer({\n  item,\n  style,\n  optionEvents,\n  optionRenderData,\n  isVirtualized,\n  stickyCategories\n}: {\n  item: IComboboxItem;\n  style: CSSProperties;\n  optionEvents: IComboboxOptionEvents;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  optionRenderData: any;\n  isVirtualized: boolean;\n  stickyCategories?: boolean;\n}) {\n  const { type, ...otherArgs } = item;\n  let customClassNames;\n  let innerElement;\n  switch (type) {\n    case COMBOBOX_DIVIDER_ITEM: {\n      innerElement = dividerItemRenderer({ id: otherArgs.id, height: otherArgs.height });\n      break;\n    }\n    case COMBOBOX_CATEGORY_ITEM: {\n      innerElement = categoryItemRenderer({\n        id: otherArgs.id,\n        category: otherArgs.category,\n        className: otherArgs.className\n      });\n      if (stickyCategories && !isVirtualized) {\n        customClassNames = styles.sticky;\n      }\n      break;\n    }\n    case COMBOBOX_OPTION_ITEM: {\n      innerElement = optionItemRenderer({\n        ...otherArgs,\n        ...optionEvents,\n        ...optionRenderData\n      });\n      break;\n    }\n  }\n\n  return (\n    <div key={otherArgs.id} className={cx(styles.comboboxItemContainer, customClassNames)} style={style}>\n      {innerElement}\n    </div>\n  );\n}\n\nexport function dividerItemRenderer({ id, height }: { id: string; height: number }) {\n  return (\n    <div className={styles.dividerContainer} style={{ height: height }}>\n      <Divider className={styles.divider} key={id} />\n    </div>\n  );\n}\n\nexport function categoryItemRenderer({\n  id,\n  category,\n  className\n}: {\n  id: string;\n  category: IComboboxCategory;\n  className: string;\n}) {\n  return <ComboboxCategory key={id} category={category} className={className} />;\n}\n\nexport function optionItemRenderer({\n  id,\n  index,\n  option,\n  className,\n  onOptionClick,\n  onOptionEnter,\n  onOptionLeave,\n  optionLineHeight,\n  optionRenderer,\n  scrollRef,\n  shouldScrollToSelectedItem,\n  activeItemIndex,\n  visualFocusItemIndex\n}: IOptionItemRendererArgs) {\n  return (\n    <ComboboxOption\n      className={className}\n      index={index}\n      key={id}\n      option={option}\n      optionRenderer={optionRenderer}\n      scrollRef={scrollRef}\n      isActive={activeItemIndex === index}\n      visualFocus={index === visualFocusItemIndex}\n      onOptionClick={onOptionClick}\n      onOptionHover={onOptionEnter}\n      onOptionLeave={onOptionLeave}\n      onOptionEnter={onOptionEnter}\n      optionLineHeight={optionLineHeight}\n      shouldScrollWhenActive={shouldScrollToSelectedItem}\n    />\n  );\n}\n"],"names":["DIVIDER_HEIGHT","CATEGORY_HEIGHT","useItemsData","_ref","categories","options","filterValue","withCategoriesDivider","optionLineHeight","useMemo","items","selectableItems","itemsMap","Map","optionsByCategories","getOptionsByCategories","optionIndex","Object","keys","forEach","categoryId","categoryIndex","withDivider","push","createDividerItemObject","isCategoryWithOptions","length","isFirstCategory","categoryObject","createCategoryItemObject","categoryData","className","cx","_defineProperty","comboboxItemsStyles","categoryWithOptions","categoryWithoutOptions","firstCategory","set","option","itemObject","createOptionItemObject","height","index","id","map","useKeyboardNavigation","_ref2","defaultVisualFocusFirstIndex","inputRef","onClick","isChildSelectable","getOptionId","filteredOptionsIds","_useActiveDescendantL","useActiveDescendantListFocus","focusedElementRef","focusedElementRole","roles","COMBOBOX","itemsIds","onItemClick","isItemSelectable","isIgnoreSpaceAsItemSelection","visualFocusItemIndex","visualFocusItemId","onOptionClick","onItemClickCallback","_ref3","type","COMBOBOX_DIVIDER_ITEM","concat","_ref4","COMBOBOX_CATEGORY_ITEM","category","_ref5","COMBOBOX_OPTION_ITEM","belongToCategory","optionRenderer","isActive","shouldScrollToSelectedItem","comboboxItemRenderer","_ref6","customClassNames","innerElement","item","style","optionEvents","optionRenderData","isVirtualized","stickyCategories","otherArgs","__rest","dividerItemRenderer","categoryItemRenderer","styles","sticky","optionItemRenderer","assign","React","createElement","key","comboboxItemContainer","_ref7","dividerContainer","Divider","divider","_ref8","ComboboxCategory","_ref9","onOptionEnter","ComboboxOption","scrollRef","activeItemIndex","visualFocus","onOptionHover","onOptionLeave","shouldScrollWhenActive"],"mappings":"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"}