import{inherits as e,createClass as n,toConsumableArray as o,classCallCheck as t,callSuper as i}from"../../../_virtual/_rollupPluginBabelHelpers.js";import s from"classnames";import a,{PureComponent as r}from"react";import{createPortal as l}from"react-dom";import{Manager as u,Reference as d,Popper as h}from"react-popper";import{DialogPosition as c}from"../../constants/positions.js";import{isFunction as p}from"lodash-es";import{backwardCompatibilityForProperties as g}from"../../helpers/backwardCompatibilityForProperties.js";import{NOOP as m,convertToArray as f,chainFunctions as v}from"../../utils/function-utils.js";import{DialogContent as E}from"./DialogContent/DialogContent.js";import{isInsideClass as D}from"../../utils/dom-utils.js";import{Refable as y}from"../Refable/Refable.js";import{HideShowEvent as w,AnimationType as C}from"../../constants/dialog.js";import T from"./Dialog.module.scss.js";import{getTestId as k,ComponentDefaultTestId as S}from"../../tests/testIds.js";var O=function(c){function m(e){var n;return t(this,m),(n=i(this,m,[e])).state={shouldUseDerivedStateFromProps:e.useDerivedStateFromProps,isOpen:e.shouldShowOnMount},n.onMouseEnter=n.onMouseEnter.bind(n),n.onMouseLeave=n.onMouseLeave.bind(n),n.onMouseDown=n.onMouseDown.bind(n),n.onClick=n.onClick.bind(n),n.onFocus=n.onFocus.bind(n),n.onBlur=n.onBlur.bind(n),n.isShown=n.isShown.bind(n),n.onEsc=n.onEsc.bind(n),n.onClickOutside=n.onClickOutside.bind(n),n.onDialogEnter=n.onDialogEnter.bind(n),n.onDialogLeave=n.onDialogLeave.bind(n),n.getContainer=n.getContainer.bind(n),n.onContentClick=n.onContentClick.bind(n),n.onKeyDown=n.onKeyDown.bind(n),n.closeDialogOnEscape=n.closeDialogOnEscape.bind(n),n.onContextMenu=n.onContextMenu.bind(n),n.hideTimeout=null,n.showTimeout=null,n}return e(m,r),n(m,[{key:"closeDialogOnEscape",value:function(e){if(this.state.isOpen)switch(e.key){case"Escape":this.hideDialogIfNeeded(e,w.ESCAPE_KEY);break;case"Tab":this.handleEvent(w.TAB_KEY,e.target,e);break;case"Enter":this.handleEvent(w.ENTER,e.target,e)}}},{key:"componentDidMount",value:function(){var e=this.props,n=e.onDialogDidShow,o=g([e.shouldCallbackOnMount,e.shoudlCallbackOnMount],!1),t=this.state.isOpen;document.addEventListener("keyup",this.closeDialogOnEscape),o&&t&&n&&n()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.closeDialogOnEscape)}},{key:"getContainer",value:function(){var e=this.props.containerSelector;if(!e)return document.body;var n=document.querySelector(e);return n&&n instanceof Element?n:document.body}},{key:"showDialog",value:function(e,n){var o=this,t=this.props,i=t.instantShowAndHide,s=t.getDynamicShowDelay,a=t.showDelay,r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).preventAnimation;if(s){var l=s();a=l.showDelay||0,r=r||l.preventAnimation}i?(this.onShowDialog(e,n),this.setState({isOpen:!0,preventAnimation:r}),this.showTimeout=null):this.showTimeout=setTimeout((function(){o.onShowDialog(e,n),o.showTimeout=null,o.setState({isOpen:!0,preventAnimation:r})}),a)}},{key:"onShowDialog",value:function(e,n){this.isShown()||(0,this.props.onDialogDidShow)(e,n)}},{key:"showDialogIfNeeded",value:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.props.disable||(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.showTimeout||this.showDialog(e,n,o))}},{key:"hideDialog",value:function(e,n){var o=this,t=this.props,i=t.hideDelay;t.instantShowAndHide?(this.onHideDialog(e,n),this.setState({isOpen:!1}),this.hideTimeout=null):this.hideTimeout=setTimeout((function(){o.onHideDialog(e,n),o.setState({isOpen:!1}),o.hideTimeout=null}),i)}},{key:"onHideDialog",value:function(e,n){var o=this.props.onDialogDidHide;o&&o(e,n)}},{key:"hideDialogIfNeeded",value:function(e,n){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null),this.hideTimeout||this.hideDialog(e,n)}},{key:"handleEvent",value:function(e,n,o){var t=this.props,i=t.showTriggerIgnoreClass,s=t.hideTriggerIgnoreClass;return!this.isShowTrigger(e)||this.isShown()||D(n,i)?this.isHideTrigger(e)&&!D(n,s)?this.hideDialogIfNeeded(o,e):void 0:this.showDialogIfNeeded(o,e)}},{key:"isShown",value:function(){return this.state.isOpen||this.props.open}},{key:"isShowTrigger",value:function(e){var n=this.props,o=n.addKeyboardHideShowTriggersByDefault,t=f(n.showTrigger);return!(!o||e!==w.FOCUS||-1>=t.indexOf(w.MOUSE_ENTER))||t.indexOf(e)>-1}},{key:"isHideTrigger",value:function(e){var n=this.props,o=n.addKeyboardHideShowTriggersByDefault,t=f(n.hideTrigger);return!(!o||e!==w.BLUR||-1>=t.indexOf(w.MOUSE_LEAVE))||t.indexOf(e)>-1}},{key:"onMouseEnter",value:function(e){this.handleEvent(w.MOUSE_ENTER,e.target,e)}},{key:"onMouseLeave",value:function(e){this.handleEvent(w.MOUSE_LEAVE,e.target,e)}},{key:"onClick",value:function(e){e.button||this.handleEvent(w.CLICK,e.target,e)}},{key:"onKeyDown",value:function(e){"Enter"===e.key&&this.handleEvent(w.ENTER,e.target,e),"Tab"===e.key&&this.handleEvent(w.TAB_KEY,e.target,e)}},{key:"onMouseDown",value:function(e){e.button||this.handleEvent(w.MOUSE_DOWN,e.target,e)}},{key:"onFocus",value:function(e){this.handleEvent(w.FOCUS,e.target,e)}},{key:"onBlur",value:function(e){this.handleEvent(w.BLUR,e.relatedTarget,e)}},{key:"onEsc",value:function(e){this.handleEvent(w.ESCAPE_KEY,e.target,e)}},{key:"onContextMenu",value:function(e){var n=this.isShown();(this.isShowTrigger(w.CONTEXT_MENU)&&!n||this.isHideTrigger(w.CONTEXT_MENU)&&n)&&e.preventDefault(),this.handleEvent(w.CONTEXT_MENU,e.target,e)}},{key:"onClickOutside",value:function(e){var n=this.props.onClickOutside;this.handleEvent(w.CLICK_OUTSIDE,e.target,e),n(e)}},{key:"onDialogEnter",value:function(e){this.props.showOnDialogEnter&&this.showDialogIfNeeded(e,"DialogEnter")}},{key:"onDialogLeave",value:function(e){this.props.showOnDialogEnter&&this.hideDialogIfNeeded(e,"DialogLeave")}},{key:"onContentClick",value:function(e){var n=this.props.onContentClick;this.handleEvent(w.CONTENT_CLICK,e.target,e),n(e)}},{key:"render",value:function(){var e=this,n=this.props,t=n.wrapperClassName,i=n.content,r=n.startingEdge,c=n.children,g=n.preventAnimationOnMount,m=n.animationType,f=n.position,v=n.showDelay,D=n.moveBy,C=n.modifiers,O=n.tooltip,M=n.tooltipClassName,N=n.referenceWrapperClassName,L=n.zIndex,H=n.hideWhenReferenceHidden,A=n.disableContainerScroll,I=n.containerSelector,U=this.state.preventAnimation,_=n["data-testid"]||k(S.DIALOG,n.id),K=!this.isHideTrigger(w.CLICK_OUTSIDE),x=g||U?void 0:m,B=p(i)?i():i;return B?a.createElement(u,null,a.createElement(d,null,(function(n){var o=n.ref;return a.createElement(y,{className:s(N),ref:o,onBlur:b("onBlur",e,e.props),onKeyDown:b("onKeyDown",e,e.props),onClick:b("onClick",e,e.props),onFocus:b("onFocus",e,e.props),onMouseDown:b("onMouseDown",e,e.props),onMouseEnter:b("onMouseEnter",e,e.props),onMouseLeave:b("onMouseLeave",e,e.props),onContextMenu:b("onContextMenu",e,e.props)},c)})),l(a.createElement(h,{placement:f,modifiers:[{name:"offset",options:{offset:[D.secondary,D.main]}},{name:"zIndex",enabled:!0,phase:"write",fn:function(e){var n=e.state;return L&&(n.styles.popper.zIndex=L+""),n}},{name:"rotator",enabled:!0,phase:"write",fn:function(e){var n=e.state;return n.styles.arrow?(n.styles.arrow.transform="".concat(n.styles.arrow.transform," rotate(45deg)"),n):n}}].concat(o(C))},(function(n){var o=n.placement,i=n.style,l=n.ref,u=n.arrowProps,d=n.isReferenceHidden;if(!e.isShown()&&o)return null;if(H&&d){var h=new CustomEvent("onReferenceHidden");e.hideDialog(h,"onReferenceHidden")}return a.createElement(E,{"data-testid":_,isReferenceHidden:H&&d,onMouseEnter:e.onDialogEnter,onMouseLeave:e.onDialogLeave,disableOnClickOutside:K,onClickOutside:e.onClickOutside,onContextMenu:e.onContextMenu,onEsc:e.onEsc,animationType:x,position:o,wrapperClassName:t,startingEdge:r,isOpen:e.isShown(),showDelay:v,styleObject:i,ref:l,onClick:e.onContentClick,hasTooltip:!!O,containerSelector:I,disableContainerScroll:A},B,O&&a.createElement("div",{style:u.style,ref:u.ref,className:s(T.arrow,M),"data-placement":o}))})),this.getContainer())):c}}],[{key:"getDerivedStateFromProps",value:function(e,n){return n.shouldUseDerivedStateFromProps?{isOpen:e.isOpen}:null}}])}();function b(e,n,o){return v([o[e],n[e]],!0)}O.hideShowTriggers=w,O.positions=c,O.animationTypes=C,O.defaultProps={position:"top",modifiers:[],moveBy:{main:0,secondary:0},showDelay:100,hideDelay:100,showTrigger:O.hideShowTriggers.MOUSE_ENTER,hideTrigger:O.hideShowTriggers.MOUSE_LEAVE,showOnDialogEnter:!1,shouldShowOnMount:!1,disable:!1,open:!1,animationType:O.animationTypes.EXPAND,preventAnimationOnMount:!1,containerSelector:"body",tooltip:!1,onDialogDidShow:m,onDialogDidHide:m,onClickOutside:m,onContentClick:m,useDerivedStateFromProps:!1,hideWhenReferenceHidden:!1,shoudlCallbackOnMount:!1,shouldCallbackOnMount:!1,instantShowAndHide:!1,addKeyboardHideShowTriggersByDefault:!1};export{O as default};
//# sourceMappingURL=Dialog.js.map
