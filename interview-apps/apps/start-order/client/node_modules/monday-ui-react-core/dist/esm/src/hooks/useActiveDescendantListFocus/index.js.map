{"version":3,"file":"index.js","sources":["../../../../../src/hooks/useActiveDescendantListFocus/index.ts"],"sourcesContent":["import React, { useMemo, useState, useCallback, MutableRefObject } from \"react\";\nimport {\n  useSupportArrowsKeyboardNavigation,\n  useSupportPressItemKeyboardNavigation,\n  useSetDefaultItemOnFocusEvent,\n  useKeepFocusOnItemWhenListChanged,\n  useCleanVisualFocusOnBlur\n} from \"./useActiveDescendantListFocusHooks\";\n\nenum Role {\n  APPLICATION = \"application\",\n  COMBOBOX = \"combobox\",\n  COMPOSITE = \"composite\",\n  GROUP = \"group\",\n  TEXTBOX = \"textbox\",\n  MENU = \"menu\"\n}\n\nfunction useActiveDescendantListFocus({\n  focusedElementRef, // the reference for the component that listens to keyboard\n  itemsIds,\n  isItemSelectable,\n  onItemClick,\n  defaultVisualFocusFirstIndex = false,\n  focusedElementRole = Role.GROUP,\n  isHorizontalList = false,\n  isIgnoreSpaceAsItemSelection = false,\n  useDocumentEventListeners = false,\n  ignoreDocumentFallback = false\n}: {\n  focusedElementRef: MutableRefObject<HTMLElement>;\n  itemsIds: string[];\n  isItemSelectable: (index: number) => boolean;\n  onItemClick: (event: React.KeyboardEvent | React.MouseEvent, index: number) => void;\n  defaultVisualFocusFirstIndex?: boolean;\n  focusedElementRole?: Role;\n  isHorizontalList?: boolean;\n  isIgnoreSpaceAsItemSelection?: boolean;\n  useDocumentEventListeners?: boolean;\n  ignoreDocumentFallback?: boolean;\n}) {\n  const defaultVisualFocusItemIndex = defaultVisualFocusFirstIndex ? 0 : -1;\n  const itemsCount = itemsIds.length;\n  const [visualFocusItemIndex, setVisualFocusItemIndex] = useState<number>(-1);\n  const visualFocusItemId = itemsIds[visualFocusItemIndex];\n\n  const listenerOptions = useMemo(() => {\n    if (useDocumentEventListeners) {\n      return ignoreDocumentFallback ? { ignoreDocumentFallback } : undefined;\n    }\n\n    return {\n      ref: focusedElementRef,\n      preventDefault: true,\n      stopPropagation: true\n    };\n  }, [useDocumentEventListeners, focusedElementRef, ignoreDocumentFallback]);\n\n  const { triggeredByKeyboard } = useSetDefaultItemOnFocusEvent({\n    focusedElementRef,\n    isItemSelectable,\n    visualFocusItemIndex,\n    setVisualFocusItemIndex,\n    itemsCount,\n    defaultVisualFocusItemIndex\n  });\n\n  const setVisualFocusItemId = useCallback(\n    (visualFocusItemId: string, isTriggeredByKeyboard: boolean) => {\n      triggeredByKeyboard.current = isTriggeredByKeyboard;\n      const itemIndex = itemsIds.indexOf(visualFocusItemId);\n      if (itemIndex > -1 && itemIndex !== visualFocusItemIndex) {\n        setVisualFocusItemIndex(itemIndex);\n      }\n    },\n    [itemsIds, triggeredByKeyboard, visualFocusItemIndex]\n  );\n\n  useSupportArrowsKeyboardNavigation({\n    itemsCount,\n    focusedElementRef,\n    visualFocusItemIndex,\n    setVisualFocusItemIndex,\n    triggeredByKeyboard,\n    isHorizontalList,\n    isItemSelectable,\n    listenerOptions\n  });\n\n  useSupportPressItemKeyboardNavigation({\n    visualFocusItemIndex,\n    itemsCount,\n    focusedElementRef,\n    setVisualFocusItemIndex,\n    onItemClick,\n    isItemSelectable,\n    listenerOptions,\n    isIgnoreSpaceAsItemSelection\n  });\n\n  useKeepFocusOnItemWhenListChanged({\n    visualFocusItemIndex,\n    itemsIds,\n    isItemSelectable,\n    setVisualFocusItemIndex\n  });\n\n  useCleanVisualFocusOnBlur({ focusedElementRef, visualFocusItemIndex, setVisualFocusItemIndex });\n\n  // this callback function is not needed anymore (the developer does not need to replace  the element's on click with this callback).\n  // we keep it for backward compatibility\n  const backwardCompatibilityCreateOnClickCallback = useCallback(\n    (itemIndex: number) => (event: React.KeyboardEvent | React.MouseEvent) => onItemClick(event, itemIndex),\n    [onItemClick]\n  );\n  return {\n    visualFocusItemIndex: triggeredByKeyboard.current ? visualFocusItemIndex : undefined,\n    visualFocusItemId: triggeredByKeyboard.current ? visualFocusItemId : undefined,\n    focusedElementProps: {\n      \"aria-activedescendant\": triggeredByKeyboard.current ? visualFocusItemId : undefined,\n      role: focusedElementRole\n    },\n    // this callback function is not needed anymore (the developer does not need to replace  the element's on click with this callback).\n    // we keep it for backward compatibility\n    onItemClickCallback: onItemClick,\n    createOnItemClickCallback: backwardCompatibilityCreateOnClickCallback,\n    setVisualFocusItemId\n  };\n}\n\nuseActiveDescendantListFocus.roles = Role;\n\nexport default useActiveDescendantListFocus;\n"],"names":["Role","useActiveDescendantListFocus","_ref","focusedElementRef","itemsIds","isItemSelectable","onItemClick","_ref$defaultVisualFoc","defaultVisualFocusFirstIndex","_ref$focusedElementRo","focusedElementRole","GROUP","_ref$isHorizontalList","isHorizontalList","_ref$isIgnoreSpaceAsI","isIgnoreSpaceAsItemSelection","_ref$useDocumentEvent","useDocumentEventListeners","_ref$ignoreDocumentFa","ignoreDocumentFallback","defaultVisualFocusItemIndex","itemsCount","length","_useState","useState","_useState2","_slicedToArray","visualFocusItemIndex","setVisualFocusItemIndex","visualFocusItemId","listenerOptions","useMemo","undefined","ref","preventDefault","stopPropagation","triggeredByKeyboard","useSetDefaultItemOnFocusEvent","setVisualFocusItemId","useCallback","isTriggeredByKeyboard","current","itemIndex","indexOf","useSupportArrowsKeyboardNavigation","useSupportPressItemKeyboardNavigation","useKeepFocusOnItemWhenListChanged","useCleanVisualFocusOnBlur","backwardCompatibilityCreateOnClickCallback","event","focusedElementProps","role","onItemClickCallback","createOnItemClickCallback","roles"],"mappings":"8XASA,IAAKA,EASL,SAASC,EAA4BC,GAsBpC,IArBCC,EAAiBD,EAAjBC,kBACAC,EAAQF,EAARE,SACAC,EAAgBH,EAAhBG,iBACAC,EAAWJ,EAAXI,YAAWC,EAAAL,EACXM,6BAAoCC,EAAAP,EACpCQ,mBAAAA,OAAkB,IAAAD,EAAGT,EAAKW,MAAKF,EAAAG,EAAAV,EAC/BW,iBAAAA,OAAmB,IAAHD,GAAQA,EAAAE,EAAAZ,EACxBa,6BAAAA,OAA+B,IAAHD,GAAQA,EAAAE,EAAAd,EACpCe,0BAAAA,OAA4B,IAAHD,GAAQA,EAAAE,EAAAhB,EACjCiB,uBAAAA,OAAyB,IAAHD,GAAQA,EAaxBE,OAlByB,IAAHb,GAAQA,EAkB+B,GAAK,EAClEc,EAAajB,EAASkB,OAC5BC,EAAwDC,GAAkB,GAAEC,EAAAC,EAAAH,EAAA,GAArEI,EAAoBF,EAAA,GAAEG,EAAuBH,EAAA,GAC9CI,EAAoBzB,EAASuB,GAE7BG,EAAkBC,GAAQ,WAC9B,OAAId,EACKE,EAAyB,CAAEA,uBAAAA,QAA2Ba,EAGxD,CACLC,IAAK9B,EACL+B,gBAAgB,EAChBC,iBAAiB,EAEpB,GAAE,CAAClB,EAA2Bd,EAAmBgB,IAE1CiB,EAAwBC,EAA8B,CAC5DlC,kBAAAA,EACAE,iBAAAA,EACAsB,qBAAAA,EACAC,wBAAAA,EACAP,WAAAA,EACAD,4BAAAA,IANMgB,oBASFE,EAAuBC,GAC3B,SAACV,EAA2BW,GAC1BJ,EAAoBK,QAAUD,EAC9B,IAAME,EAAYtC,EAASuC,QAAQd,GAC/Ba,GAAa,GAAKA,IAAcf,GAClCC,EAAwBc,EAE3B,GACD,CAACtC,EAAUgC,EAAqBT,IAGlCiB,EAAmC,CACjCvB,WAAAA,EACAlB,kBAAAA,EACAwB,qBAAAA,EACAC,wBAAAA,EACAQ,oBAAAA,EACAvB,iBAAAA,EACAR,iBAAAA,EACAyB,gBAAAA,IAGFe,EAAsC,CACpClB,qBAAAA,EACAN,WAAAA,EACAlB,kBAAAA,EACAyB,wBAAAA,EACAtB,YAAAA,EACAD,iBAAAA,EACAyB,gBAAAA,EACAf,6BAAAA,IAGF+B,EAAkC,CAChCnB,qBAAAA,EACAvB,SAAAA,EACAC,iBAAAA,EACAuB,wBAAAA,IAGFmB,EAA0B,CAAE5C,kBAAAA,EAAmBwB,qBAAAA,EAAsBC,wBAAAA,IAIrE,IAAMoB,EAA6CT,GACjD,SAACG,GAAiB,OAAK,SAACO,GAA6C,OAAK3C,EAAY2C,EAAOP,EAAU,IACvG,CAACpC,IAEH,MAAO,CACLqB,qBAAsBS,EAAoBK,QAAUd,OAAuBK,EAC3EH,kBAAmBO,EAAoBK,QAAUZ,OAAoBG,EACrEkB,oBAAqB,CACnB,wBAAyBd,EAAoBK,QAAUZ,OAAoBG,EAC3EmB,KAAMzC,GAIR0C,oBAAqB9C,EACrB+C,0BAA2BL,EAC3BV,qBAAAA,EAEJ,EAvHA,SAAKtC,GACHA,EAAA,YAAA,cACAA,EAAA,SAAA,WACAA,EAAA,UAAA,YACAA,EAAA,MAAA,QACAA,EAAA,QAAA,UACAA,EAAA,KAAA,MACD,CAPD,CAAKA,IAAAA,EAOJ,CAAA,IAkHDC,EAA6BqD,MAAQtD"}