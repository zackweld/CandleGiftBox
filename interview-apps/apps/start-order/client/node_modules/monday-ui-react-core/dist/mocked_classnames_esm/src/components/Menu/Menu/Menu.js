import{slicedToArray as e}from"../../../../_virtual/_rollupPluginBabelHelpers.js";import n from"classnames";import{SIZES as t}from"../../../constants/sizes.js";import s,{forwardRef as o,useRef as i,useState as u,useMemo as r,useCallback as l,useEffect as d,useLayoutEffect as a}from"react";import c from"../../../hooks/useMergeRef.js";import m from"../../../hooks/useClickOutside/index.js";import{backwardCompatibilityForProperties as p}from"../../../helpers/backwardCompatibilityForProperties.js";import v from"./hooks/useSubMenuIndex.js";import f from"./hooks/useOnCloseMenu.js";import I from"./hooks/useCloseMenuOnKeyEvent.js";import M from"./hooks/useMenuKeyboardNavigation.js";import b from"./hooks/useMouseLeave.js";import{useAdjacentSelectableMenuIndex as x}from"./hooks/useAdjacentSelectableMenuIndex.js";import{useFocusWithin as h}from"../../../hooks/useFocusWithin.js";import S from"../../../hooks/usePrevious/index.js";import{withStaticProps as j}from"../../../types/withStaticProps.js";import{getStyle as O}from"../../../helpers/typesciptCssModulesHelper.js";import{getTestId as k}from"../../../tests/testIds.js";import{ComponentDefaultTestId as C}from"../../../tests/constants.js";import{useFocusOnMount as g}from"./hooks/useFocusOnMount.js";import{useMenuId as y}from"./hooks/useMenuId.js";import{generateMenuItemId as A}from"./utils/utils.js";import E from"./Menu.module.scss.js";var F=o((function(t,o){var j=t.id,P=t.className,B=t.classname,N=t.size,D=void 0===N?F.sizes.MEDIUM:N,L=t.tabIndex,V=void 0===L?0:L,z=t.ariaLabel,R=void 0===z?"Menu":z,T=t.ariaDescribedBy,U=t.children,W=t.isVisible,w=void 0===W||W,H=t.onClose,K=t.onItemFocus,_=t.focusOnMount,q=void 0!==_&&_,G=t.focusItemIndex,J=void 0===G?-1:G,Q=t.focusItemIndexOnMount,X=void 0===Q?-1:Q,Y=t.isSubMenu,Z=void 0!==Y&&Y,$=t.useDocumentEventListeners,ee=void 0!==$&&$,ne=t.shouldScrollMenu,te=void 0!==ne&&ne,se=t["data-testid"],oe=i(null),ie=c(oe,o),ue=y(j),re=i(null),le=p([P,B]),de=u(J),ae=e(de,2),ce=ae[0],me=ae[1],pe=u(!1),ve=e(pe,2),fe=ve[0],Ie=ve[1],Me=r((function(){return s.Children.toArray(U).filter((function(e){return!!e.type.isMenuChild||(console.error("Menu child must be a menuChild item (such as MenuItem, MenuDivider, MenuTitle, etc). This child is not supported: ",e),!1)}))}),[U]),be=l((function(e){var n,t,o;me(e);var i=Me[e],u=s.isValidElement(i)?(null===(n=null==i?void 0:i.props)||void 0===n?void 0:n.id)||"".concat(ue,"-item-").concat(e):void 0;u?null===(t=null==oe?void 0:oe.current)||void 0===t||t.setAttribute("aria-activedescendant",u):null===(o=null==oe?void 0:oe.current)||void 0===o||o.removeAttribute("aria-activedescendant")}),[Me,ue]),xe=l((function(e){K&&K(e),be(e),Ie(!1)}),[be,K]),he=v(),Se=he.setSubMenuIsOpenByIndex,je=he.hasOpenSubMenu,Oe=he.openSubMenuIndex,ke=he.resetOpenSubMenuIndex,Ce=f({setActiveItemIndex:xe,setOpenSubMenuIndex:he.setOpenSubMenuIndex,onClose:H});m({ref:oe,callback:function(){return Ce()}}),I({hasOpenSubMenu:je,onCloseMenu:Ce,ref:oe,onClose:H,isSubMenu:Z,useDocumentEventListeners:ee});var ge=x({children:Me}),ye=ge.getNextSelectableIndex,Ae=ge.getPreviousSelectableIndex;M({hasOpenSubMenu:je,getNextSelectableIndex:ye,getPreviousSelectableIndex:Ae,activeItemIndex:ce,setActiveItemIndex:xe,isVisible:w,ref:oe,useDocumentEventListeners:ee}),b({resetOpenSubMenuIndex:ke,hasOpenSubMenu:je,ref:oe,setActiveItemIndex:xe}),g({focusItemIndexOnMount:X,focusChildOnMount:Me[X],getNextSelectableIndex:ye,updateActiveItemIndex:be,setIsInitialFocusSet:Ie});var Ee=l((function(){Ie(!0)}),[Ie]),Fe=S(je);d((function(){var e;je||ee||ce>-1&&Fe&&(null===(e=null==oe?void 0:oe.current)||void 0===e||e.focus())}),[ce,je,Fe,ee]),a((function(){q&&!ee&&requestAnimationFrame((function(){oe&&oe.current&&oe.current.focus()}))}),[oe,q,ee]);var Pe=h({onBlurWithin:function(){Ce&&Ce()}}).focusWithinProps;return s.createElement("ul",{onFocus:null==Pe?void 0:Pe.onFocus,onBlur:null==Pe?void 0:Pe.onBlur,id:ue,"data-testid":se||k(C.MENU,j),className:n(E.menu,O(E,D),le),ref:ie,tabIndex:V,"aria-label":R,role:"menu","aria-describedby":T,onMouseOver:Ee},Me&&s.Children.map(Me,(function(e,n){return s.isValidElement(e)?s.cloneElement(e,Object.assign(Object.assign({},null==e?void 0:e.props),{activeItemIndex:ce,index:n,setActiveItemIndex:be,menuRef:oe,resetOpenSubMenuIndex:ke,isParentMenuVisible:w,setSubMenuIsOpenByIndex:Se,hasOpenSubMenu:n===Oe,closeMenu:Ce,id:A(ue,e,n),useDocumentEventListeners:ee,isInitialSelectedState:fe,shouldScrollMenu:te,getNextSelectableIndex:ye,getPreviousSelectableIndex:Ae,isUnderSubMenu:Z,splitMenuItemIconButtonRef:re})):null})))}));Object.assign(F,{isMenu:!0,supportFocusOnMount:!0});var P=j(F,{sizes:t});export{P as default};
//# sourceMappingURL=Menu.js.map
